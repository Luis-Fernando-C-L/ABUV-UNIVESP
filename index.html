<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ABUV - Associa√ß√£o de Bairros Unidos Venceremos.</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
<style>
:root { --cor-primaria: #1b2845; --cor-secundaria: #00b351; }
html { font-size: 100%; } /* base p/ A+ A- */
body { margin: 0; font-family: "Segoe UI", Arial, sans-serif; scroll-behavior: smooth; color: #333; background:#fff; line-height: 1.5; }
* { box-sizing: border-box; }

/* Skip link */
.skip-link { position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
.skip-link:focus { position: fixed; left: 12px; top: 12px; padding:10px 14px; background:#000; color:#fff; z-index: 2001; border-radius:8px; }

/* Toolbar */
.a11y-toolbar { position: fixed; right: 10px; bottom: 10px; z-index: 1200; display:flex; gap:6px; flex-wrap:wrap; }
.a11y-toolbar button { padding:0.5rem 0.625rem; border-radius:8px; border:1px solid #ccc; background:#fff; cursor:pointer; font-size:0.875rem; }
.a11y-toolbar button:focus { outline: 3px solid #005fcc; outline-offset:2px; }

/* Foco vis√≠vel */
a, button, [role="button"], .atividade { outline-offset:2px; }
a:focus, button:focus, [role="button"]:focus, .atividade:focus { outline: 3px solid #005fcc; }

/* Alto contraste, espa√ßamento extra */
.high-contrast, .high-contrast * { color: #fff !important; background: #000 !important; border-color:#fff !important; }
.extra-spacing { letter-spacing: 0.3px; line-height: 1.8; }

/* Menos anima√ß√£o (sistema) */
@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
}
/* Menos anima√ß√£o (bot√£o) */
.reduce-motion * { animation: none !important; transition: none !important; }
/* Cards sempre vis√≠veis quando menos anima√ß√£o */
@media (prefers-reduced-motion: reduce) { .atividade { opacity: 1 !important; transform: none !important; animation: none !important; } }
.reduce-motion .atividade { opacity: 1 !important; transform: none !important; animation: none !important; cursor: default; }
/* Galeria sem intera√ß√£o quando menos anima√ß√£o */
.reduce-motion .galeria-img { cursor: default; }

/* topo */
nav { position: fixed; top: 0; left: 0; right: 0; background: #fff; padding: 0.9375rem 1.5625rem; z-index: 1000; display: flex; gap: 1.375rem; white-space: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; align-items: center; justify-content: flex-start; }
nav a { text-decoration: none; color: #333; font-weight: bold; font-size: 1.03125rem; transition: color 0.3s, transform 0.3s; }
nav a:hover, nav a:focus { color: var(--cor-secundaria); transform: scale(1.05); }
@media (max-width: 480px) { nav { padding: 0.59375rem 0.84375rem; gap: 0.84375rem; } nav a { font-size: 0.90625rem; } }

header { height: 100vh; display: flex; justify-content: center; align-items: center; background-color: #fff; }
header img.logo { width: 320px; max-width: 80%; }

/* se√ß√µes */
section { padding: 5rem 1.25rem; font-size: 1.25rem; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; min-height: 100vh; }
#quem-somos { background-color: #e0f7fa; }
#atividades { background: linear-gradient(135deg, #fff3e0, #ffe0b2); }
#banco-dados { background: linear-gradient(135deg, #e3f2fd, #bbdefb); }
#contato { background: linear-gradient(135deg, #fce4ec, #f8bbd0); scroll-margin-top: 80px; }

/* bot√µes */
.botao-formulario { display: inline-block; padding: 0.75rem 1.5rem; background-color: var(--cor-primaria); color: white; text-decoration: none; border-radius: 8px; font-weight: bold; transition: background-color 0.3s, transform 0.2s; border:none; cursor:pointer; font-size: 1rem; }
.botao-formulario:hover, .botao-formulario:focus { background-color: var(--cor-secundaria); transform: scale(1.05); }

/* galeria */
.galeria { display: flex; flex-wrap: wrap; justify-content: center; gap: 0.9375rem; margin-top: 1.875rem; }
.galeria-img { width: 13.75rem; height: 10rem; object-fit: cover; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.3s, opacity 0.3s; }
.galeria-img:hover, .galeria-img:focus { transform: scale(1.05); opacity: 0.9; }

/* modal */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display:flex; justify-content:center; align-items:center; z-index:2000; opacity: 0; animation: fadeIn 0.25s forwards; flex-direction: column; padding: 12px; }
.modal-card { background:#fff; padding:24px; border-radius:12px; max-width:1000px; width:95%; text-align:left; }
.modal-img { max-width:90%; max-height:80%; border-radius:12px; }
.modal-controls { margin-top: 20px; display:flex; gap:10px; }

/* >>> Bot√µes do modal iguais ao c√≥digo 2 <<< */
.modal-controls button {
  padding: 12px 20px;
  margin: 0 10px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background-color: var(--cor-primaria);
  color: #fff;
  transition: background-color 0.3s;
}
.modal-controls button:hover,
.modal-controls button:focus {
  background-color: var(--cor-secundaria);
}

/* atividades */
.atividade { background: #fff; padding: 1.5625rem 1.25rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); min-width: 15.625rem; max-width: 17.5rem; display: flex; flex-direction: column; align-items: center; transition: transform 0.3s, opacity 0.4s; cursor: pointer; opacity: 0; animation: slideUp 0.5s forwards; text-align: center; }
.atividade h3 { color: var(--cor-secundaria); margin-bottom: 0.75rem; }
@keyframes fadeIn { to { opacity:1; } }
@keyframes slideUp { from { transform: translateY(20px); opacity:0; } to { transform: translateY(0); opacity:1; } }

/* formul√°rio */
.form-db { display: grid; grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); gap: 15px; width: 100%; max-width: 1100px; margin-top: 20px; }
.form-db input,.form-db select,.form-db textarea { padding: 10px; border-radius: 8px; border: 1px solid #ccc; width: 100%; font-size: 1rem; }
.form-db textarea { grid-column: 1 / -1; resize: none; height: 90px; }

/* ajuda visual */
input[required], select[required], textarea[required] { border-left: 4px solid #007bff; }

/* tabela */
.table-wrap { width:100%; overflow-x:auto; margin-top: 30px; }
.table-db { width:100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden; }
.table-db caption { text-align:left; padding:10px; font-weight:bold; }
.table-db th, .table-db td { padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.08); text-align: left; font-size: 0.9375rem; }
.table-db th { background: var(--cor-primaria); color: #fff; }
.table-db tr:hover td { background: rgba(0,0,0,0.05); }
.table-actions button { margin-right:8px; }
.pagination { margin-top: 15px; display: flex; justify-content: center; gap: 15px; align-items:center; }
.pagination button { background: var(--cor-primaria); color: #fff; border: none; border-radius: 6px; padding: 8px 14px; cursor: pointer; transition: background 0.3s; font-size: 1rem; }
.pagination button:disabled { opacity: .5; cursor: default; }
.pagination button:hover:not(:disabled), .pagination button:focus:not(:disabled) { background: var(--cor-secundaria); }

/* footer */
footer { text-align: center; padding: 50px 20px; color: #333; border-top: 3px solid var(--cor-secundaria); min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
footer h2 { color: var(--cor-secundaria); font-size: 2.625rem; margin-bottom: 25px; }
footer p { margin: 12px 0; font-size: 1.375rem; }
footer .social a { color: #E4405F; font-size: 3.75rem; margin: 0 15px; transition: transform 0.3s ease, opacity 0.3s ease; }
footer .social a:hover, footer .social a:focus { transform: scale(1.2); opacity: 0.8; }
.badge { margin-top:10px; font-size:0.875rem; color:#555; }

/* links de contato */
.contact-link { color: inherit; text-decoration: none; }
.contact-link:hover, .contact-link:focus { text-decoration: underline; }

/* util */
.visually-hidden { position:absolute !important; left:-10000px !important; top:auto !important; width:1px !important; height:1px !important; overflow:hidden !important; }

/* Ocultar coluna ID visualmente */
.table-db thead th:first-child, .table-db tbody td:first-child { display: none; }
</style>
</head>
<body>
<a href="#conteudo-principal" class="skip-link">Pular para o conte√∫do</a>

<div class="a11y-toolbar" aria-label="Ferramentas de acessibilidade">
  <button type="button" id="btn-contrast" title="Ativar/Desativar alto contraste">Contraste</button>
  <button type="button" id="btn-font+" title="Aumentar tamanho do texto">A+</button>
  <button type="button" id="btn-font-" title="Diminuir tamanho do texto">A‚àí</button>
  <button type="button" id="btn-spacing" title="Aumentar espa√ßamento de linhas e letras">Espa√ßamento</button>
  <button type="button" id="btn-motion" title="Reduzir anima√ß√µes e expandir tudo">Menos anima√ß√£o</button>
</div>

<nav role="navigation" aria-label="Principal">
  <a href="#topo">ABUV</a>
  <a href="#quem-somos">Quem Somos</a>
  <a href="#atividades">Atividades</a>
  <a href="#banco-dados">Cadastro</a>
  <a href="#contato">Contato</a>
</nav>

<div id="app" role="main" tabindex="-1" id="conteudo-principal">
  <header id="topo" aria-label="In√≠cio">
    <img alt="Logo da ABUV, Associa√ß√£o de Bairros Unidos Venceremos" class="logo" src="logo.png"/>
  </header>

  <!-- QUEM SOMOS -->
  <section id="quem-somos" aria-labelledby="titulo-quem-somos">
    <h2 id="titulo-quem-somos">Quem Somos</h2>
    <p v-for="p in textoQuemSomos">{{ p }}</p>
    <div class="galeria" role="list" aria-label="Galeria de fotos 'Quem Somos'">
      <!-- Galeria: desativa clique quando reduceMotionActive -->
      <img
        v-for="(img,i) in imagens"
        :key="img"
        :src="img"
        class="galeria-img"
        :alt="'Foto da ABUV n√∫mero ' + (i+1)"
        :role="reduceMotionActive ? null : 'button'"
        :tabindex="reduceMotionActive ? -1 : 0"
        @click="!reduceMotionActive && openModal(i)"
        @keydown.enter.prevent="!reduceMotionActive && openModal(i)"
        @keydown.space.prevent="!reduceMotionActive && openModal(i)"
      />
    </div>
  </section>

  <!-- ATIVIDADES -->
  <section id="atividades" aria-labelledby="titulo-atividades">
    <h2 id="titulo-atividades">Atividades</h2>

    <div class="atividades-carousel" style="display:flex; gap:20px; justify-content:center; flex-wrap:wrap;">
      <div
        class="atividade"
        v-for="(item, nome) in atividades"
        :key="nome"
        @click="!reduceMotionActive && toggle(nome)"
        @keydown.enter.prevent="!reduceMotionActive && toggle(nome)"
        @keydown.space.prevent="!reduceMotionActive && toggle(nome)"
        :aria-expanded="(reduceMotionActive || active===nome) ? 'true' : 'false'"
        :role="reduceMotionActive ? null : 'button'"
        :tabindex="reduceMotionActive ? -1 : 0"
        :aria-controls="'detalhes-'+nome"
      >
        <h3 style="margin-bottom:6px">{{ nome }}</h3>
        <p style="margin:0 0 8px">{{ item.resumo }}</p>

        <!-- Detalhes: sempre abertos com menos anima√ß√£o -->
        <div v-if="reduceMotionActive || active===nome" :id="'detalhes-'+nome" style="margin-top:10px; text-align:left; width:100%;">
          <ul style="padding-left:18px; margin:0 0 8px;">
            <li v-for="(linha, i) in item.agenda" :key="i">
              <strong>{{ linha.dia }}:</strong>
              <span>{{ linha.horas.join(', ') }}</span>
              <span v-if="linha.local"> ‚Ä¢ {{ linha.local }}</span>
            </li>
          </ul>
          <p v-if="item.extra" style="margin:8px 0 0; font-size:0.875rem; opacity:.9;">{{ item.extra }}</p>
          <p style="margin:10px 0 0;">
            <a :href="'https://www.google.com/search?q='+encodeURIComponent(nome+' '+(item.localPadrao||''))" target="_blank" style="text-decoration: underline;" @click.stop>Mais informa√ß√µes</a>
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- BANCO DE DADOS -->
  <section id="banco-dados" aria-labelledby="titulo-cadastro">
    <h2 id="titulo-cadastro">Cadastro</h2>
    <div class="badge" role="status" aria-live="polite">üîó Status da API: <strong>{{ apiStatus }}</strong></div>

    <form @submit.prevent="insertRegistro" class="form-db" aria-describedby="dica-form">
      <p id="dica-form" class="visually-hidden">Todos os campos marcados como obrigat√≥rios precisam ser preenchidos.</p>

      <input v-model="novo.nomeResponsavel" id="nomeResponsavel" placeholder="Nome do respons√°vel" required aria-label="Nome do respons√°vel">
      <input v-model="novo.email" id="email" type="email" placeholder="E-mail" required aria-label="E-mail">
      <input v-model="novo.celular" id="celular" placeholder="Celular" required aria-label="Celular">
      <input v-model="novo.logradouro" id="logradouro" placeholder="Logradouro" required aria-label="Logradouro">
      <input v-model="novo.numero" id="numero" placeholder="N√∫mero" required aria-label="N√∫mero">
      <input v-model="novo.bairro" id="bairro" placeholder="Bairro" required aria-label="Bairro">
      <input v-model="novo.complemento" id="complemento" placeholder="Complemento" aria-label="Complemento">
      <input v-model="novo.cidade" id="cidade" placeholder="Cidade" required aria-label="Cidade">
      <input v-model="novo.nomeAluno" id="nomeAluno" placeholder="Nome do aluno" required aria-label="Nome do aluno">
      <input v-model.number="novo.idade" id="idade" type="number" min="1" placeholder="Idade" required aria-label="Idade">
      <select v-model="novo.modalidade" required aria-label="Modalidade">
        <option disabled value="">Modalidade</option>
        <option>Jiu Jitsu</option>
        <option>Muay Thai</option>
        <option>Krav Mag√°</option>
        <option>Gin√°stica</option>
        <option>Volunt√°rio</option>
      </select>
      <textarea v-model="novo.observacoes" id="observacoes" placeholder="Observa√ß√µes" aria-label="Observa√ß√µes"></textarea>

      <button type="submit" class="botao-formulario" :disabled="loading">INSERT</button>
      <button type="button" class="botao-formulario" style="background:#dc3545;" @click="resetBanco" :disabled="loading">DELETE ALL</button>
    </form>

    <div style="margin-top:20px; width:100%; max-width:900px;">
      <input v-model="filtro" placeholder="Buscar por nome do aluno ou do respons√°vel..." style="width:100%; padding:10px; border-radius:8px; border:1px solid #ccc;" aria-label="Buscar por nome do aluno ou do respons√°vel">
      <p style="margin:10px 0 0 0;"><strong>{{ registrosFiltrados.length }} registros encontrados</strong></p>
    </div>

    <div class="table-wrap">
      <table class="table-db" aria-describedby="legenda-tabela">
        <caption id="legenda-tabela">Lista de cadastros com a√ß√µes de ver, editar e excluir</caption>
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">N¬∫</th>
            <th scope="col">Aluno</th>
            <th scope="col">Respons√°vel</th>
            <th scope="col">Idade</th>
            <th scope="col">Cidade</th>
            <th scope="col">Modalidade</th>
            <th scope="col">A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(r, i) in paginated" :key="r.id">
            <td>{{ r.id }}</td>
            <td>{{ (page - 1) * perPage + i + 1 }}</td>
            <td>{{ r.nomeAluno }}</td>
            <td>{{ r.nomeResponsavel }}</td>
            <td>{{ r.idade }}</td>
            <td>{{ r.cidade }}</td>
            <td>{{ r.modalidade }}</td>
            <td class="table-actions">
              <button @click="viewDetalhes(r)" class="botao-formulario" style="background:#6c757d;" aria-label="Ver detalhes do cadastro de {{r.nomeAluno}}">üîç Ver detalhes</button>
              <button @click="openEdit(r)" class="botao-formulario" style="background:#007bff;" aria-label="Editar cadastro de {{r.nomeAluno}}">üñãÔ∏è Editar</button>
              <button @click="deleteRegistro(r)" class="botao-formulario" style="background:#dc3545;" aria-label="Excluir cadastro de {{r.nomeAluno}}">üóëÔ∏è Excluir</button>
            </td>
          </tr>
          <tr v-if="!loading && paginated.length === 0">
            <td colspan="8" style="padding:12px; text-align:center; color:#666;">Nenhum registro encontrado.</td>
          </tr>
          <tr v-if="loading">
            <td colspan="8" style="padding:12px; text-align:center; color:#666;">Carregando‚Ä¶</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination" v-if="totalPages > 1" role="navigation" aria-label="Pagina√ß√£o de cadastros">
      <button @click="prevPage" :disabled="page===1 || loading" aria-label="P√°gina anterior">‚ü® Anterior</button>
      <span aria-live="polite">P√°gina {{ page }} / {{ totalPages }}</span>
      <button @click="nextPage" :disabled="page===totalPages || loading" aria-label="Pr√≥xima p√°gina">Pr√≥ximo ‚ü©</button>
    </div>
  </section>

  <!-- CONTATO -->
  <footer id="contato" aria-labelledby="titulo-contato">
    <h2 id="titulo-contato">Contato</h2>
    <p><a href="tel:+5514996711920" class="contact-link" title="Ligar para ABUV"><i class="fas fa-phone" aria-hidden="true"></i> <span aria-label="Telefone">+55 (14) 99671-1920</span></a></p>
    <p><a href="mailto:abuvtupa@email.com" class="contact-link" title="Enviar e-mail para ABUV"><i class="fas fa-envelope" aria-hidden="true"></i> <span aria-label="E-mail">abuvtupa@email.com</span></a></p>
    <p>üìç Rua Pioneiro Gallo Soares, n¬∫ 140 ‚Äì Bairro Jos√© Feliciano ‚Äì Tup√£/SP</p>
    <div class="social">
      <a href="https://www.instagram.com/abuvtupa/" target="_blank" title="Instagram da ABUV" aria-label="Abrir Instagram da ABUV"><i class="fab fa-instagram" aria-hidden="true"></i></a>
    </div>
  </footer>

  <!-- MODAIS -->
  <div v-if="modalOpen" class="modal" role="dialog" aria-modal="true" aria-label="Visualiza√ß√£o de imagem da galeria" @click="closeModal">
    <img :src="modalImage" class="modal-img" alt="Imagem ampliada" @click.stop/>
    <div class="modal-controls" @click.stop>
      <button ref="firstModalBtn" @click.stop="prevImage">‚ü® Anterior</button>
      <button @click.stop="nextImage">Pr√≥ximo ‚ü©</button>
      <!-- Ajuste: impedir propaga√ß√£o e chamar closeModal -->
      <button @click.stop="closeModal">Fechar ‚úï</button>
    </div>
  </div>

  <div v-if="detalhes" class="modal" role="dialog" aria-modal="true" aria-labelledby="titulo-detalhes" @click="detalhes=null">
    <div class="modal-card" @click.stop>
      <h3 id="titulo-detalhes" style="margin-top:0; color:var(--cor-secundaria);">Detalhes do Cadastro</h3>
      <p><b>Respons√°vel:</b> {{ detalhes.nomeResponsavel }}</p>
      <p><b>E-mail:</b> {{ detalhes.email }}</p>
      <p><b>Celular:</b> {{ detalhes.celular }}</p>
      <p><b>Endere√ßo:</b> {{ detalhes.logradouro }}, n¬∫ {{ detalhes.numero }} - {{ detalhes.bairro }} ({{ detalhes.cidade }})</p>
      <p v-if="detalhes.complemento"><b>Complemento:</b> {{ detalhes.complemento }}</p>
      <p><b>Aluno:</b> {{ detalhes.nomeAluno }} - {{ detalhes.idade }} anos</p>
      <p><b>Modalidade:</b> {{ detalhes.modalidade }}</p>
      <p><b>Observa√ß√µes:</b> {{ detalhes.observacoes || '‚Äî' }}</p>
      <div style="text-align:right; margin-top:10px;">
        <button class="botao-formulario" @click="detalhes=null">Fechar</button>
      </div>
    </div>
  </div>

  <div v-if="editModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="titulo-editar" @click="closeEdit">
    <div class="modal-card" @click.stop>
      <h3 id="titulo-editar" style="margin-top:0; color:var(--cor-secundaria);">Editar cadastro</h3>
      <div class="form-db">
        <input v-model="editBuffer.nomeResponsavel" placeholder="Nome do respons√°vel" required aria-label="Nome do respons√°vel">
        <input v-model="editBuffer.email" type="email" placeholder="E-mail" required aria-label="E-mail">
        <input v-model="editBuffer.celular" placeholder="Celular" required aria-label="Celular">
        <input v-model="editBuffer.logradouro" placeholder="Logradouro" required aria-label="Logradouro">
        <input v-model="editBuffer.numero" placeholder="N√∫mero" required aria-label="N√∫mero">
        <input v-model="editBuffer.bairro" placeholder="Bairro" required aria-label="Bairro">
        <input v-model="editBuffer.complemento" placeholder="Complemento" aria-label="Complemento">
        <input v-model="editBuffer.cidade" placeholder="Cidade" required aria-label="Cidade">
        <input v-model="editBuffer.nomeAluno" placeholder="Nome do aluno" required aria-label="Nome do aluno">
        <input v-model.number="editBuffer.idade" type="number" min="1" placeholder="Idade" required aria-label="Idade">
        <select v-model="editBuffer.modalidade" required aria-label="Modalidade">
          <option>Jiu Jitsu</option>
          <option>Muay Thai</option>
          <option>Krav Mag√°</option>
          <option>Gin√°stica</option>
          <option>Volunt√°rio</option>
        </select>
        <textarea v-model="editBuffer.observacoes" placeholder="Observa√ß√µes" aria-label="Observa√ß√µes"></textarea>
      </div>
      <div style="display:flex; gap:12px; justify-content:flex-end; margin-top:16px;">
        <button class="botao-formulario" style="background:#28a745;" @click="saveEdit">üíæ Salvar</button>
        <button class="botao-formulario" style="background:#6c757d;" @click="closeEdit">Cancelar</button>
      </div>
    </div>
  </div>
</div>

<script>
const API = 'https://script.google.com/macros/s/AKfycbyQMKKSEzg1DmceApbitOu3CkDIOBwUfwE42lMDEmHUD3myu-xfi6nIu_MR2cUjN8sQWQ/exec';

new Vue({
  el: '#app',
  data: {
    textoQuemSomos: [
      'A ABUV (Associa√ß√£o de bairro unidos venceremos) √© uma organiza√ß√£o comunit√°ria na cidade de Tup√£ comprometida em melhorar a qualidade de vida e promover o bem-estar dos moradores de diversos bairros. Atrav√©s de um trabalho conjunto e engajado, a dire√ß√£o da associa√ß√£o se dedica a coordenar e implementar uma variedade de atividades em beneficio da comunidade.',
      'A associa√ß√£o atua como uma ponte entre os moradores e as autoridades locais, buscando solu√ß√µes para os problemas enfrentados pelos bairros, bem como identificando oportunidades de desenvolvimento. Atrav√©s de um di√°logo aberto e constante, a dire√ß√£o da associa√ß√£o representa os interesses dos moradores, levando suas demandas √†s inst√¢ncias apropriadas e trabalhando em parceria com as autoridades para alcan√ßar resultados positivos.',
      'As atividades promovidas pela associa√ß√£o s√£o diversas e abrangem √°reas como educa√ß√£o, cultura, esportes, meio ambiente e assist√™ncia social. Atrav√©s de projetos e iniciativas, a dire√ß√£o da associa√ß√£o busca criar oportunidades de aprendizado, fortalecer os la√ßos comunit√°rios, preservar o patrim√¥nio cultural, fomentar a pr√°tica esportiva e proporcionar suporte √†s familias em situa√ß√£o de vulnerabilidade.'
    ],
    atividades: {
      'Gin√°stica': { resumo: 'Atividade f√≠sica para sa√∫de e disposi√ß√£o.', localPadrao: 'Quadra coberta', extra: 'Traga garrafinha de √°gua e tapete se tiver.', agenda: [
        { dia: 'Ter',  horas: ['09:00','15:00','19:00'], local: 'Quadra coberta' },
        { dia: 'Qui', horas: ['09:00','15:00','19:00'], local: 'Quadra coberta' },
        { dia: 'Sab', horas: ['09:00','15:00','19:00'], local: 'Quadra coberta' },
      ]},
      'Jiu Jitsu': { resumo: 'T√©cnica, disciplina e respeito.', localPadrao: 'Sala 1', extra: 'Kimono obrigat√≥rio ap√≥s a 1¬™ semana experimental.', agenda: [
        { dia: 'Seg', horas: ['19:00‚Äì20:30'], local: 'Sala 1' },
        { dia: 'Qua', horas: ['19:00‚Äì20:30'], local: 'Sala 1' },
        { dia: 'Sex', horas: ['19:00‚Äì20:30'], local: 'Sala 1' },
      ]},
      'Krav Mag√°': { resumo: 'Defesa pessoal pr√°tica e objetiva.', localPadrao: 'Sala 2', extra: 'Recomenda-se protetor bucal.', agenda: [
        { dia: 'Seg', horas: ['20:30‚Äì22:00'], local: 'Sala 2' },
        { dia: 'Qua', horas: ['20:30‚Äì22:00'], local: 'Sala 2' },
        { dia: 'Sex', horas: ['20:30‚Äì22:00'], local: 'Sala 2' },
      ]},
      'Muay Thai': { resumo: 'Resist√™ncia, coordena√ß√£o e agilidade.', localPadrao: 'Sala 2', extra: 'Use bandagens e luvas; temos pares para aula experimental.', agenda: [
        { dia: 'Ter', horas: ['18:30‚Äì20:00'], local: 'Sala 2' },
        { dia: 'Qui', horas: ['18:30‚Äì20:00'], local: 'Sala 2' },
      ]},
    },
    imagens: ['1.jfif','2.jfif','3.jfif','4.jfif','5.jfif','6.jfif'],
    active: null,
    reduceMotionActive: false, /* <<< NOVO: estado do bot√£o "Menos anima√ß√£o" */
    banco: [],
    novo: { nomeResponsavel:'', email:'', celular:'', logradouro:'', numero:'', bairro:'', complemento:'', cidade:'', nomeAluno:'', idade:'', modalidade:'', observacoes:'' },
    filtro: '',
    page: 1, perPage: 5, loading: false, apiStatus: 'desconectado',
    modalOpen: false, modalIndex: 0, modalImage: '',
    detalhes: null, editModal: false, editBuffer: null
  },
  computed: {
    registrosFiltrados() {
      if (!this.filtro) return this.banco;
      const f = this.filtro.toLowerCase();
      return this.banco.filter(r =>
        (r.nomeAluno || '').toLowerCase().includes(f) ||
        (r.nomeResponsavel || '').toLowerCase().includes(f)
      );
    },
    totalPages() { return Math.ceil(this.registrosFiltrados.length / this.perPage) || 1; },
    paginated() {
      const start = (this.page - 1) * this.perPage;
      return this.registrosFiltrados.slice(start, start + this.perPage);
    }
  },
  watch: { filtro() { this.page = 1; } },
  methods: {
    /* API */
    async apiGetList() {
      const url = API + '?action=list';
      const r = await fetch(url, { method: 'GET' });
      if (!r.ok) throw new Error('Falha ao listar');
      const data = await r.json();
      this.banco = Array.isArray(data) ? data : (data.data || []);
    },
    async apiPost(action, payload) {
      const r = await fetch(API + '?action=' + action, { method: 'POST', body: JSON.stringify(payload || {}) });
      const json = await r.json();
      if (!r.ok || json.ok === false) throw new Error(json.error || 'Erro');
      return json.data;
    },
    setStatus(ok) { this.apiStatus = ok ? 'conectado' : 'desconectado'; },

    /* UI helpers */
    openModal(i) {
      this.modalIndex = i; this.modalImage = this.imagens[i]; this.modalOpen = true;
      this.$nextTick(() => { this.$refs.firstModalBtn?.focus(); });
      document.addEventListener('keydown', this.handleModalKeys);
    },
    /* >>> Simplificado: fecha sempre o modal <<< */
    closeModal() {
      this.modalOpen = false;
      document.removeEventListener('keydown', this.handleModalKeys);
    },
    handleModalKeys(ev) {
      if (ev.key === 'Escape') { this.modalOpen = false; ev.preventDefault(); }
      if (ev.key === 'ArrowRight') { this.nextImage(); ev.preventDefault(); }
      if (ev.key === 'ArrowLeft') { this.prevImage(); ev.preventDefault(); }
    },
    prevImage() { this.modalIndex = (this.modalIndex - 1 + this.imagens.length) % this.imagens.length; this.modalImage = this.imagens[this.modalIndex]; },
    nextImage() { this.modalIndex = (this.modalIndex + 1) % this.imagens.length; this.modalImage = this.imagens[this.modalIndex]; },
    toggle(nome) { this.active = this.active===nome?null:nome; },

    /* CRUD */
    async load() {
      this.loading = true;
      try { await this.apiGetList(); this.setStatus(true); }
      catch (e) { console.error(e); this.setStatus(false); alert('N√£o consegui conectar √† API. Verifique a URL no topo do script.'); }
      finally { this.loading = false; }
    },
    async insertRegistro() {
      this.loading = true;
      try {
        const created = await this.apiPost('insert', this.novo);
        this.banco.push(created);
        this.novo = { nomeResponsavel:'', email:'', celular:'', logradouro:'', numero:'', bairro:'', complemento:'', cidade:'', nomeAluno:'', idade:'', modalidade:'', observacoes:'' };
        this.$nextTick(() => document.querySelector('#banco-dados .table-wrap')?.scrollIntoView({behavior:'smooth'}));
        this.page = this.totalPages;
      } catch (e) { alert('Erro ao inserir: ' + e.message); }
      finally { this.loading = false; }
    },
    viewDetalhes(r) { this.detalhes = r; },
    openEdit(r) { this.editBuffer = JSON.parse(JSON.stringify(r)); this.editModal = true; },
    closeEdit() { this.editModal = false; this.editBuffer = null; },
    async saveEdit() {
      this.loading = true;
      try {
        const upd = await this.apiPost('update', this.editBuffer);
        const idx = this.banco.findIndex(x => Number(x.id) === Number(upd.id));
        if (idx !== -1) this.$set(this.banco, idx, upd);
        this.closeEdit();
      } catch (e) { alert('Erro ao salvar: ' + e.message); }
      finally { this.loading = false; }
    },
    async deleteRegistro(registro) {
      const senha = prompt('Informe a senha para excluir o registro:'); if (senha === null) return;
      if (senha !== '1234') { alert('Senha incorreta.'); return; }
      if (!confirm('Deseja realmente excluir este registro?')) return;
      this.loading = true;
      try {
        await this.apiPost('delete', { id: registro.id });
        this.banco = this.banco.filter(r => Number(r.id) !== Number(registro.id));
        if (this.page > this.totalPages) this.page = this.totalPages;
      } catch (e) { alert('Erro ao excluir: ' + e.message); }
      finally { this.loading = false; }
    },
    async resetBanco() {
      const senha = prompt('Informe a senha para APAGAR TODOS os registros:'); if (senha === null) return;
      if (senha !== '1234') { alert('Senha incorreta.'); return; }
      if (!confirm('Deseja realmente apagar todos os registros?')) return;
      this.loading = true;
      try { await this.apiPost('delete_all', {}); this.banco = []; this.page = 1; }
      catch (e) { alert('Erro ao apagar tudo: ' + e.message); }
      finally { this.loading = false; }
    },
    prevPage() { if (this.page > 1) this.page--; },
    nextPage() { if (this.page < this.totalPages) this.page++; }
  },
  mounted() {
    this.load();

    // Toolbar
    const body = document.body;
    const btnContrast = document.getElementById('btn-contrast');
    const btnFontPlus = document.getElementById('btn-font+');
    const btnFontMinus = document.getElementById('btn-font-');
    const btnSpacing = document.getElementById('btn-spacing');
    const btnMotion = document.getElementById('btn-motion');

    btnContrast.addEventListener('click', () => body.classList.toggle('high-contrast'));
    btnSpacing.addEventListener('click', () => body.classList.toggle('extra-spacing'));

    // Menos anima√ß√£o: aplica classe e muda estado Vue
    btnMotion.addEventListener('click', () => {
      body.classList.toggle('reduce-motion');
      this.reduceMotionActive = body.classList.contains('reduce-motion');
      // quando ativa, mostra todos abertos
      if (this.reduceMotionActive) this.active = '__ALL__';
      // quando desativa, fecha todos
      if (!this.reduceMotionActive) this.active = null;
    });
    // Se o SO j√° pede menos anima√ß√£o, inicia ligado
    if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      body.classList.add('reduce-motion');
      this.reduceMotionActive = true;
      this.active = '__ALL__';
    }

    // A+ / A‚àí: escala o <html> (agora tudo relevante est√° em rem)
    let fontScale = 100; // %
    const applyFontScale = () => { document.documentElement.style.fontSize = fontScale + '%'; };
    btnFontPlus.addEventListener('click', () => { fontScale = Math.min(180, fontScale + 10); applyFontScale(); });
    btnFontMinus.addEventListener('click', () => { fontScale = Math.max(80, fontScale - 10); applyFontScale(); });
  }
});
</script>
</body>
</html>
