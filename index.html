<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ABUV - Associa√ß√£o de Bairros Unidos Venceremos</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
<link rel="stylesheet" href="style.css"> <!-- seu CSS original -->
</head>
<body>

<!-- MENU FIXO COM FUNDO BRANCO -->
<nav style="
  position:fixed; top:0; left:0; right:0; height:56px;
  background:#fff; z-index:1000;
  display:flex; align-items:center; justify-content:center; gap:25px;
  white-space:nowrap; overflow-x:auto; -webkit-overflow-scrolling:touch;
  padding:12px 20px; box-shadow:0 2px 6px rgba(0,0,0,0.1);
">
  <a href="#quem-somos">Quem Somos</a>
  <a href="#atividades">Atividades</a>
  <a href="#banco-dados">Cadastro</a>
  <a href="#contato">Contato</a>
</nav>
<!-- espa√ßador para o topo fixo -->
<div style="height:56px;"></div>

<div id="app">

  <header>
    <img alt="Logo ABUV" class="logo" src="logo.png"/>
  </header>

  <section id="quem-somos">
    <h2>Quem Somos</h2>
    <p v-for="p in textoQuemSomos">{{ p }}</p>
    <div class="galeria">
      <img v-for="(img,i) in imagens" :key="img" :src="img" class="galeria-img" @click="openModal(i)"/>
    </div>
  </section>

  <section id="atividades">
    <h2>Atividades</h2>
    <div class="atividades-carousel" style="display:flex; gap:20px; justify-content:center; flex-wrap:wrap;">
      <div class="atividade" v-for="(desc, nome) in atividades" :key="nome" @click="toggle(nome)">
        <h3>{{ nome }}</h3>
        <p>{{ desc }}</p>
        <p v-if="active===nome" style="color:#007bff; margin-top:10px;">
          <a :href="'https://www.google.com/search?q='+nome" target="_blank" style="color:#007bff; text-decoration: underline;">Mais informa√ß√µes</a>
        </p>
      </div>
    </div>
  </section>

  <section id="banco-dados">
    <h2>Cadastro</h2>
    <div class="badge">üîó Status da API: <strong>{{ apiStatus }}</strong></div>

    <form @submit.prevent="insertRegistro" class="form-db">
      <input v-model="novo.nomeResponsavel" placeholder="Nome do respons√°vel" required>
      <input v-model="novo.email" type="email" placeholder="E-mail" required>
      <input v-model="novo.celular" placeholder="Celular" required>
      <input v-model="novo.logradouro" placeholder="Logradouro" required>
      <input v-model="novo.numero" placeholder="N√∫mero" required>
      <input v-model="novo.bairro" placeholder="Bairro" required>
      <input v-model="novo.complemento" placeholder="Complemento">
      <input v-model="novo.cidade" placeholder="Cidade" required>
      <input v-model="novo.nomeAluno" placeholder="Nome do aluno" required>
      <input v-model.number="novo.idade" type="number" min="1" placeholder="Idade" required>
      <select v-model="novo.modalidade" required>
        <option disabled value="">Modalidade</option>
        <option>Jiu Jitsu</option>
        <option>Muay Thai</option>
        <option>Krav Mag√°</option>
        <option>Gin√°stica</option>
      </select>
      <textarea v-model="novo.observacoes" placeholder="Observa√ß√µes"></textarea>
      <button type="submit" class="botao-formulario" :disabled="loading">INSERT</button>
      <button type="button" class="botao-formulario" style="background:#dc3545;" @click="resetBanco" :disabled="loading">DELETE ALL</button>
    </form>

    <div style="margin-top:20px; width:100%; max-width:900px;">
      <input v-model="filtro" placeholder="Buscar por nome do aluno ou do respons√°vel..." style="width:100%; padding:10px; border-radius:8px; border:1px solid #ccc;">
      <p style="margin:10px 0 0 0;"><strong>{{ registrosFiltrados.length }} registros encontrados</strong></p>
    </div>

    <div class="table-wrap">
      <table class="table-db">
        <thead>
          <tr>
            <th>ID</th>
            <th>Aluno</th>
            <th>Respons√°vel</th>
            <th>Idade</th>
            <th>Cidade</th>
            <th>Modalidade</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="r in paginated" :key="r.id">
            <td>{{ r.id }}</td>
            <td>{{ r.nomeAluno }}</td>
            <td>{{ r.nomeResponsavel }}</td>
            <td>{{ r.idade }}</td>
            <td>{{ r.cidade }}</td>
            <td>{{ r.modalidade }}</td>
            <td class="table-actions">
              <button @click="viewDetalhes(r)" class="botao-formulario" style="background:#6c757d;">üîç Ver detalhes</button>
              <button @click="openEdit(r)" class="botao-formulario" style="background:#007bff;">üñãÔ∏è Editar</button>
              <button @click="deleteRegistro(r)" class="botao-formulario" style="background:#dc3545;">üóëÔ∏è Excluir</button>
            </td>
          </tr>
          <tr v-if="!loading && paginated.length === 0">
            <td colspan="7" style="padding:12px; text-align:center; color:#666;">Nenhum registro encontrado.</td>
          </tr>
          <tr v-if="loading">
            <td colspan="7" style="padding:12px; text-align:center; color:#666;">Carregando‚Ä¶</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination" v-if="totalPages > 1">
      <button @click="prevPage" :disabled="page===1 || loading">‚ü® Anterior</button>
      <span>P√°gina {{ page }} / {{ totalPages }}</span>
      <button @click="nextPage" :disabled="page===totalPages || loading">Pr√≥ximo ‚ü©</button>
    </div>
  </section>

  <footer id="contato">
    <h2>Contato</h2>
    <p>
      <a href="tel:+5514996711920" class="contact-link" title="Ligar">
        <i class="fas fa-phone"></i> +55 (14) 99671-1920
      </a>
    </p>
    <p>
      <a href="mailto:abuvtupa@email.com" class="contact-link" title="Enviar e-mail">
        <i class="fas fa-envelope"></i> abuvtupa@email.com
      </a>
    </p>
    <p>üìç Rua Pioneiro Gallo Soares, n¬∫ 140 ‚Äì Bairro Jos√© Feliciano ‚Äì Tup√£/SP</p>
    <div class="social">
      <a href="https://www.instagram.com/abuvtupa/" target="_blank" title="Instagram da ABUV">
        <i class="fab fa-instagram"></i>
      </a>
    </div>
  </footer>

</div>

<script>
const API = 'https://script.google.com/macros/s/AKfycbyQMKKSEzg1DmceApbitOu3CkDIOBwUfwE42lMDEmHUD3myu-xfi6nIu_MR2cUjN8sQWQ/exec';

new Vue({
  el: '#app',
  data: {
    textoQuemSomos: [
      'A ABUV (Associa√ß√£o de bairro unidos venceremos) √© uma organiza√ß√£o comunit√°ria na cidade de Tup√£ comprometida em melhorar a qualidade de vida e promover o bem-estar dos moradores de diversos bairros.',
      'A associa√ß√£o atua como uma ponte entre os moradores e as autoridades locais, buscando solu√ß√µes para os problemas enfrentados pelos bairros.',
      'As atividades promovidas abrangem educa√ß√£o, cultura, esportes, meio ambiente e assist√™ncia social.'
    ],
    atividades: {
      'Gin√°stica': 'Atividade f√≠sica que melhora sa√∫de, flexibilidade e disposi√ß√£o.',
      'Jiu Jitsu': 'Aulas que ensinam t√©cnica, disciplina e respeito.',
      'Krav Mag√°': 'Treino de defesa pessoal que desenvolve reflexos e seguran√ßa.',
      'Muay Thai': 'Arte marcial que fortalece resist√™ncia, coordena√ß√£o e agilidade.'
    },
    imagens: ['1.jfif','2.jfif','3.jfif','4.jfif','5.jfif','6.jfif'],
    active: null,
    banco: [],
    novo: {
      nomeResponsavel:'', email:'', celular:'',
      logradouro:'', numero:'', bairro:'', complemento:'',
      cidade:'', nomeAluno:'', idade:'', modalidade:'', observacoes:''
    },
    filtro: '',
    page: 1,
    perPage: 10,
    loading: false,
    apiStatus: 'desconectado',
    modalOpen: false,
    modalIndex: 0,
    modalImage: '',
    detalhes: null,
    editModal: false,
    editBuffer: null
  },
  computed: {
    registrosFiltrados() {
      if (!this.filtro) return this.banco;
      const f = this.filtro.toLowerCase();
      return this.banco.filter(r =>
        (r.nomeAluno || '').toLowerCase().includes(f) ||
        (r.nomeResponsavel || '').toLowerCase().includes(f)
      );
    },
    totalPages() { return Math.ceil(this.registrosFiltrados.length / this.perPage) || 1; },
    paginated() {
      const start = (this.page - 1) * this.perPage;
      return this.registrosFiltrados.slice(start, start + this.perPage);
    }
  },
  watch: { filtro() { this.page = 1; } },
  methods: {
    async apiGetList() {
      const url = API + '?action=list';
      const r = await fetch(url, { method: 'GET' });
      if (!r.ok) throw new Error('Falha ao listar');
      const data = await r.json();
      this.banco = Array.isArray(data) ? data : (data.data || []);
    },
    async apiPost(action, payload) {
      const r = await fetch(API + '?action=' + action, {
        method: 'POST',
        body: JSON.stringify(payload || {})
      });
      const json = await r.json();
      if (!r.ok || json.ok === false) throw new Error(json.error || 'Erro');
      return json.data;
    },
    async load() {
      this.loading = true;
      try {
        await this.apiGetList();
        this.apiStatus = 'conectado';
      } catch (e) {
        this.apiStatus = 'desconectado';
        alert('N√£o consegui conectar √† API.');
      } finally { this.loading = false; }
    },
    async insertRegistro() {
      this.loading = true;
      try {
        const created = await this.apiPost('insert', this.novo);
        this.banco.push(created);
        this.novo = { nomeResponsavel:'', email:'', celular:'', logradouro:'', numero:'', bairro:'', complemento:'', cidade:'', nomeAluno:'', idade:'', modalidade:'', observacoes:'' };
      } catch (e) { alert('Erro ao inserir: ' + e.message); }
      finally { this.loading = false; }
    },
    viewDetalhes(r) { this.detalhes = r; },
    openEdit(r) { this.editBuffer = JSON.parse(JSON.stringify(r)); this.editModal = true; },
    closeEdit() { this.editModal = false; this.editBuffer = null; },
    async saveEdit() {
      this.loading = true;
      try {
        const upd = await this.apiPost('update', this.editBuffer);
        const idx = this.banco.findIndex(x => Number(x.id) === Number(upd.id));
        if (idx !== -1) this.$set(this.banco, idx, upd);
        this.closeEdit();
      } catch (e) { alert('Erro ao salvar: ' + e.message); }
      finally { this.loading = false; }
    },
    async deleteRegistro(r) {
      if (!confirm('Deseja realmente excluir este registro?')) return;
      this.loading = true;
      try {
        await this.apiPost('delete', { id: r.id });
        this.banco = this.banco.filter(x => Number(x.id) !== Number(r.id));
      } catch (e) { alert('Erro ao excluir: ' + e.message); }
      finally { this.loading = false; }
    },
    async resetBanco() {
      if (!confirm('Deseja realmente apagar todos os registros?')) return;
      this.loading = true;
      try {
        await this.apiPost('delete_all', {});
        this.banco = [];
      } catch (e) { alert('Erro ao apagar: ' + e.message); }
      finally { this.loading = false; }
    },
    prevPage() { if (this.page > 1) this.page--; },
    nextPage() { if (this.page < this.totalPages) this.page++; },
    openModal(i) { this.modalIndex = i; this.modalImage = this.imagens[i]; this.modalOpen = true; },
    prevImage() { this.modalIndex = (this.modalIndex - 1 + this.imagens.length) % this.imagens.length; this.modalImage = this.imagens[this.modalIndex]; },
    nextImage() { this.modalIndex = (this.modalIndex + 1) % this.imagens.length; this.modalImage = this.imagens[this.modalIndex]; },
    toggle(nome) { this.active = this.active===nome?null:nome; }
  },
  mounted() { this.load(); }
});
</script>
</body>
</html>
